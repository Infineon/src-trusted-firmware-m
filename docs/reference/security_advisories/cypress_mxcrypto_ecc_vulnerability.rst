Advisory TFMV-CY-1
===============

+-----------------+------------------------------------------------------------+
| Title           | NSPE may access ECC secure keys stored in TF-M Crypto      |
+=================+============================================================+
| CVE ID          | CVE-2022                                                   |
+-----------------+------------------------------------------------------------+
| Public          | 22nd March, 2022                                           |
| Disclosure Date |                                                            |
+-----------------+------------------------------------------------------------+
| Versions        | All versions starting from TF-M v1.1.0 to and including    |
| Affected        | TF-M v1.3.2                                                |
+-----------------+------------------------------------------------------------+
| Configurations  | TFM_PLATFORM=cypress/psoc64 and MBEDTLS_ECP_ALT            |
+-----------------+------------------------------------------------------------+
| Impact          | ECC secure keys stored in Crypto service can               |
|                 | be accessed from NSPE                                      |
+-----------------+------------------------------------------------------------+
| Fix Version     | `v1.3.3`_                                                  |
+-----------------+------------------------------------------------------------+
| Credit          | N/A                                                        |
+-----------------+------------------------------------------------------------+

Background
----------

Mbed TLS is configured to use hardware acceleration for ECC crypto algorithm:
 - MBEDTLS_ECP_ALT
 - MBEDTLS_ECDSA_SIGN_ALT
 - MBEDTLS_ECDSA_VERIFY_ALT
The part of SRAM memory inside MXCrypto HW block called CRYPTO_BUF is not isolated from NSPE.
So NSPE can read/modify CRYPTO_BUF memory during TF-M executes ECC operation which can lead to
user ECC secure keys leakage and on result of ECC sign and verify operation.


Impact
------

Only ECC with user keys is impacted. All the other algorithms are not affected.

Initial Attestation Service uses symmetric Initial Attestation Key (IAK) provisioned
in to Secure Flash Boot(SFB). It uses PSA Cryptography API over Crypto service
and p64_utils library, implemented in the SFB, during Initial Attestation Token sign operation.
ECC in SFB also uses HW acceleration on MXCrypto HW, but during this operation
CRYPTO_BUF memory is properly isolated from NSPE.

Therefore, Initial Attestation is not impacted.

Mitigation
----------

This issue has been fixed by update ECC Crypto algorithm configuration in Mbed TLS to use software implementation only.

`v1.3.3`_ fixed this issue.

.. _v1.3.3: https://github.com/Infineon/trusted-firmware-m/releases/tag/release-v1.3.3

---------------------

*Â© Copyright (c) 2022 Cypress Semiconductor Corporation (an Infineon company) or an affiliate of Cypress Semiconductor Corporation. All rights reserved.*
